{% extends 'AcmeDemoWorkflowBundle::layout.html.twig' %}

{% set title = workflow.label %}

{% block content %}
    <h1>{{ title }}</h1>
    <h3>{{ currentStep.label }}</h3>

    <form action="{{ path('acme_demoworkflow_workflowitem_edit', {id: workflowItem.id}) }}" method="POST">
        <div class="form-horizontal">
            {% if stepForm.children|length > 1 %}
                <h5 class="usser-fiedset"><span>Workflow Data</span></h5>
                <div class="usser-row form-container">
                    <fieldset class="form-horizontal">
                        {{ form_widget(stepForm) }}
                        {{ form_rest(stepForm) }}
                    </fieldset>
                </div>
                <div class="form-row">
                    <button class="btn btn-large btn-primary pull-right" type="submit">{{ "Save" | trans }}</button>
                </div>
            {% else %}
                <h4>No data to show</h4>
            {% endif %}
            {% if workflowItem.isClosed %}
                <h4>Workflow is closed</h4>
            {% elseif currentStep.allowedTransitions|length %}
                <br/>
                <br/>
                <h5 class="usser-fiedset"><span>Allowed Transitions</span></h5>
                {% for transitionName in currentStep.allowedTransitions %}
                    {% set transition = workflow.transitions[transitionName] %}
                    {% if workflow.isTransitionAllowed(workflowItem, transition) %}
                        <a class="btn btn-large btn-success" href="{{ path('acme_demoworkflow_workflowitem_transit', {id: workflowItem.id, transitionName: transitionName}) }}">
                            {{ transition.label }}
                        </a>
                    {% else %}
                        <button class="btn btn-large btn-info" type="submit" disabled="disabled">{{ transition.label }}</button>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </form>

    <h3>Related entities</h3>
    <h4>Phone Call</h4>

    <div class="form-horizontal">
        {% include 'AcmeDemoWorkflowBundle:PhoneCall:callDescription.html.twig' with {'phoneCall': workflowItem.data.managed_entity} %}
        <div class="span12">
            <a class="btn btn-primary" style="margin-left:10px;" href="{{ path('acme_demoworkflow_phonecall_view', {id: workflowItem.data.managed_entity.id}) }}">
                {{ "View" | trans }}
            </a>
        </div>
    </div>

{% endblock %}
