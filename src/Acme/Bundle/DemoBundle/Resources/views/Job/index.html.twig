{% extends 'AcmeDemoBundle::layout.bootstrap.html.twig' %}
{% import 'JMSJobQueueBundle:Job:macros.html.twig' as macros %}
{% use 'AcmeDemoBundle:Job:sidebar.html.twig' %}

{% block title %}Jobs overview - {{ parent() }}{% endblock %}

{% block content %}
<h1>Jobs overview</h1>

{{ pager.render('AcmeDemoBundle::pager.bootstrap.html.twig')|raw }}

<table class="table table-bordered table-striped table-condensed">
    <thead>
        <tr>
            <th>ID</th>
            <th>Command</th>
            <th>State</th>
            <th>Created At</th>
        </tr>
    </thead>

    <tbody>
        {% if pager.paginationData.current == 1 and failed|length > 0 %}
        {% for job in failed %}
        <tr>
            <td><a href="{{ path('acme_demo_job_show', { id: job.id }) }}">{{ job.id }}</a></td>
            <td><a href="{{ path('acme_demo_job_show', { id: job.id }) }}">{{ macros.command(job) }}</a></td>
            <td>{{ macros.state(job) }}</td>
            <td>{{ macros.ago(job.createdAt) }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td style="height:4px; background-color: #ccc;" colspan="4"></td>
        </tr>
        {% endif %}

        {% for job in pager %}
        <tr>
            <td><a href="{{ path('acme_demo_job_show', { id: job.id }) }}">{{ job.id }}</a></td>
            <td><a href="{{ path('acme_demo_job_show', { id: job.id }) }}">{{ macros.command(job) }}</a></td>
            <td>{{ macros.state(job) }}</td>
            <td>{{ macros.ago(job.createdAt) }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4">There are no jobs.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{{ pager.render('AcmeDemoBundle::pager.bootstrap.html.twig')|raw }}

{% endblock %}

{% block javascripts %}
    {% javascripts
        '@AcmeDemoBundle/Resources/public/js/page/jobs.js'

        output='js/jobs.js'
    %}
    <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}
{% endblock %}
